<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>/r/dailyprogrammer Challenge 108 (Intermediate)</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="main.css">
        <script src="main.js"></script>
    </head>
    <body>
        <div>
            <table id="gameboard"></table>
        </div>
        <div>
            <table>
                <tr>
                    <td><label>Input 1:</label><pre id="challenge1"></pre></td>
                    <td><label>Output 1:</label><pre id="test1"></pre></td>
                </tr>
                <tr>
                    <td><label>Input 2:</label><pre id="challenge2"></pre></td>
                    <td><label>Output 2:</label><pre id="test2"></pre></td>
                </tr>
                <tr>
                    <td><label>Input 3:</label><pre id="challenge3"></pre></td>
                    <td><label>Output 3:</label><pre id="test3"></pre></td>
                </tr>
                <tr>
                    <td><label>Input 4:</label><pre id="challenge4"></pre></td>
                    <td><label>Output 4:</label><pre id="test4"></pre></td>
                </tr>
            </table>
        </div>
        <script>
            document.getElementById('challenge1').textContent = challenge1;
            render('test1', generate(challenge1));
            document.getElementById('challenge2').textContent = challenge2;
            render('test2', generate(challenge2));
            document.getElementById('challenge3').textContent = challenge3;
            render('test3', generate(challenge3));
            document.getElementById('challenge4').textContent = challenge4;
            render('test4', generate(challenge4));
            
            var gameRows = 20;
            var gameCols = 20;
            var gameMines = 75;
            var gameData = [];
            var gameboard = document.getElementById('gameboard');
            var gameInit = false;
            var gameOver = false;
            
            function leftclickHandler(event) {
                if (!gameOver) {
                    var row = event.target.dataset.row;
                    var col = event.target.dataset.col;
                    var ptd = event.target.parentElement;
                    ptd.removeChild(event.target);
                    if (!gameInit) {
                        gameData = generateGameData([gameRows, gameCols, gameMines], row, col);
                        gameInit = true;
                    } else {
                        var cellData = gameData[row].charAt(col);
                        if (cellData == '✷') {
                            var p = document.createElement('p');
                            p.textContent = '✷';
                            document.getElementById('cell-' + row + '-' + col).appendChild(p);
                            gameOver = true;
                            alert('Game Over');
                        } else if (cellData != '0') {
                            var p = document.createElement('p');
                            p.textContent = cellData;
                            document.getElementById('cell-' + row + '-' + col).appendChild(p);
                        } else {
                            
                        }
                    }
                }
            }
            
            function rightclickHandler(event) {
                if (!gameOver) {
                    event.preventDefault();
                    if (gameInit) {
                        $(event.target).toggleClass('flagged')
                    }
                    return false;
                }
            }
            
            for(var r = 0; r < gameRows; r++) {
                var row = document.createElement('tr');
                for(var c = 0; c < gameCols; c++) {
                    var col = document.createElement('td');
                    col.setAttribute('id', 'cell-' + r + '-' + c);
                    var button = document.createElement('button');
                    button.setAttribute('data-row', r);
                    button.setAttribute('data-col', c);
                    button.addEventListener('click', leftclickHandler);
                    button.addEventListener('contextmenu', rightclickHandler);
                    col.appendChild(button);
                    row.appendChild(col);
                }
                gameboard.appendChild(row);
            }
        </script>
    </body>
</html>